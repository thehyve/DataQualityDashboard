<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Failure Thresholds and How to Change Them • DataQualityDashboard</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Failure Thresholds and How to Change Them">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DataQualityDashboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/DataQualityDashboard.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CheckTypeDescriptions.html">Data Quality Check Type Definitions</a>
    </li>
    <li>
      <a href="../articles/DqdForCohorts.html">Running the DQD on a Cohort</a>
    </li>
    <li>
      <a href="../articles/Thresholds.html">Failure Thresholds and How to Change Them</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OHDSI/DataQualityDashboard">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Failure Thresholds and How to Change Them</h1>
                        <h4 class="author">Clair Blacketer</h4>
            
            <h4 class="date">2020-07-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/DataQualityDashboard/blob/master/vignettes/Thresholds.rmd"><code>vignettes/Thresholds.rmd</code></a></small>
      <div class="hidden name"><code>Thresholds.rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Failure Thresholds and How to Change Them}
-->
<div id="dqd-failure-thresholds" class="section level1">
<h1 class="hasAnchor">
<a href="#dqd-failure-thresholds" class="anchor"></a>DQD Failure Thresholds</h1>
<p>As described in the <a href="https://ohdsi.github.io/DataQualityDashboard/#introduction">introduction to the tool</a>, the Data Quality Dashboard works by systematically applying 20 data quality check types to a database by leveraging the structure of the OMOP Common Data Model. This process results in over 3,300 potential data quality checks. These checks are then resolved against the database, each one producing a number and percent of records that fail. The percent failure is then compared against a number to determine if the check itself should be marked as a pass or a fail overall. Essentially, the threshold number is the percent of failed records for a particular check you are willing to accept. If the percent failures is lower than the threshold then it passes, otherwise the check fails.</p>
<p>A default set of failure thresholds are shipped with the package. Many of these are general thresholds determined by CDM experts and were designed to test the minimum quality measures necessary to run an analysis on a database. They do not take into account an apriori knowledge of the database or data that is available. With that in mind, it is possible to change the failure thresholds and even set different thresholds for different databases.</p>
<div id="dqd-control-files" class="section level2">
<h2 class="hasAnchor">
<a href="#dqd-control-files" class="anchor"></a>DQD Control Files</h2>
<p>There is a set of three csv files that underly the DQD. These files indicate which checks should be run and what their failure thresholds should be. There is one file per check level: TABLE, FIELD, and CONCEPT. This vignette will walk through how to update the field level check thresholds but the process is the same for all three files.</p>
<div id="step-1-find-and-copy-the-control-files" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-find-and-copy-the-control-files" class="anchor"></a>Step 1: Find and copy the control files</h3>
<p>The control files are located in the R package in the inst/csv folder and can also be downloaded <a href="https://github.com/OHDSI/DataQualityDashboard/tree/master/inst/csv">here</a>. In that location there should be four files per CDM version the DQD supports. These are:</p>
<ul>
<li>
<strong>OMOP_CDMvx.x.x_Check_Descriptions.csv</strong>: This file contains the check types, their descriptions, and which sql file is associated with each. It does not contain any failure thresholds and should not need to be changed.</li>
<li>
<strong>OMOP_CDMvx.x.x_Table_Level.csv</strong>: This file has a list of all tables in the CDM version and any checks to be performed at this level as well as the failure thresholds associated. Right now only the checktype <a href="https://ohdsi.github.io/DataQualityDashboard/articles/CheckTypeDescriptions.html#measurepersoncompleteness">measurePersonCompleteness</a> is considered a table level check. If you would like to change the failure thresholds for the measurePersonCompleteness check copy this file to a location the R instance can access.</li>
<li>
<strong>OMOP_CDMvx.x.x_Field_Level.csv</strong>: This file has a list of all tables and fields in the CDM version and any checks to be performed at this level as well as the failure thresholds associated. The majority of the <a href="https://ohdsi.github.io/DataQualityDashboard/articles/CheckTypeDescriptions.html">check types</a> run by the DQD are field level checks. If you would like to change the failure thresholds for any of these checks copy this file to a location the R instance can access. An example of this file is seen in figure 1 below.</li>
</ul>
<div class="figure">
<img src="images/fieldLevelFile.png" alt="Figure 1: Field Level Control File Example"><p class="caption">Figure 1: Field Level Control File Example</p>
</div>
<ul>
<li>
<strong>OMOP_CDMvx.x.x_Concept_Level.csv</strong>: This file has a list of all concepts and any checks to be performed on that concept. For example, there are checks that evaluate biologically plausible ranges for measurement values, like <a href="https://ohdsi.github.io/DataQualityDashboard/articles/CheckTypeDescriptions.html#plausiblevaluelow-1">plausibleValueLow</a>. If you would like to change the failure thresholds for any of these checks copy this file to a location the R instance can access.</li>
</ul>
</div>
<div id="step-2-turn-onoff-checks-and-change-thresholds" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-turn-onoff-checks-and-change-thresholds" class="anchor"></a>Step 2: Turn On/Off Checks and Change Thresholds</h3>
<p>Using the field level file as an example, when you open it there will be two columns listing the tables and fields in the OMOP CDM, as seen in figure 1. Moving horizontally through the file there will be a column named for each of the <a href="https://ohdsi.github.io/DataQualityDashboard/articles/CheckTypeDescriptions.html">check types</a> available to run at the field level. At the intersection of each check type and CDM field will be a cell with either a ‘Yes’ or ‘No’ value. A ‘Yes’ indicates that the check type will be run for that specific table and field. For example in figure 1 there is a ‘Yes’ in the <strong>isRequired</strong> column for the field <strong>person_id</strong> in the <strong>PERSON</strong> table. This means that the <a href="https://ohdsi.github.io/DataQualityDashboard/articles/CheckTypeDescriptions.html#isRequired"><strong>isRequired</strong></a> check will be run, substituting <strong>person_id</strong> for cdmFieldName and <strong>PERSON</strong> for cdmTableName.</p>
<p>So instead of the generic check type: <em>The number and percent of records with a NULL value in the <strong>cdmFieldName</strong> of the <strong>cdmTableName</strong> that is considered not nullable</em></p>
<p>The ‘Yes’ in cell C2 in figure 1 will resolve that check type to an individual data quality check: <em>The number and percent of records with a NULL value in the <strong>person_id</strong> of the <strong>PERSON</strong> table that is considered not nullable</em></p>
<p>Using this method it is possible to turn checks on or off by changing the ‘Yes’/‘No’ values in the control files. This will affect individual checks only. If you would like to filter checks based on check level (TABLE, FIELD, CONCEPT), check type (turn off all fkClass checks, for example), or CDM table (turn off all checks for the COST table), this can be done at the execution step and does not need to be specified in the control file. The vignette <strong>Advanced DQD Execution Options</strong> details how to do this.</p>
<p>For each check type column in the control file there will be one or more additional columns based on the inputs the check type needs to function. For instance the isForeignKey check has the fields fkTableName and fkFieldName so that the check knows where to find the primary key associated with the foreign key. Each check type will also have a column named using the convention <strong>checktype</strong>Threshold. This is the column that lists the threshold against which the check will be evaluated to determine a pass or fail. Similarly to how the ‘Yes’/‘No’ indicators work, the intersection of each CDM field and check type threshold field will hold a value that will be compared to the outcome of the check to determine if the check passes or fails. In figure 1 for the check that is turned on in cell C2 the threshold is listed in cell D2. In this case the value is 0 indicating that if any records in the database violate the rule then this check will fail.</p>
<p>To change the threshold for a check, input a value between 0 and 100. The threshold value is based on the percent of records that violate a check and indicates the percent of violating records you are willing to tolerate. A 0 thresholds means that any violating records will cause the check to fail and a 100 means that all records evaluated could violate the check and the check will still pass. After changing any thresholds in the control files, save the files in a location that the R instance can access.</p>
</div>
<div id="step-2a-documenting-metadata-on-updated-thresholds" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2a-documenting-metadata-on-updated-thresholds" class="anchor"></a>Step 2a: Documenting Metadata on Updated Thresholds</h3>
<p>In addition to thresholds, each check type will also have a column named using the convention <strong>checktype</strong>Notes. These columns allow entry of any information about why a particular check threshold was changed for a certain database, or perhaps record a link to an issue tracking system to denote that a failure has been identified and a fix is in the works. If any notes are recorded these will be exposed in the shiny application.</p>
</div>
<div id="step-3-run-the-dqd-using-the-updated-thresholds" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3-run-the-dqd-using-the-updated-thresholds" class="anchor"></a>Step 3: Run the DQD Using the Updated Thresholds</h3>
<p>Follow the instructions on the <a href="https://ohdsi.github.io/DataQualityDashboard/articles/DataQualityDashboard.html">Getting Started</a> page to set the parameters to run the Data Quality Dashboard. When running the execute function, point the package to the updated threshold files as shown in the example below. To do this, The options <strong>tableCheckThresholdLoc</strong>, <strong>fieldCheckThresholdLoc</strong>, <strong>conceptCheckThresholdLoc</strong> should contain the fully qualified location of the files. If you would like to revert to the default thresholds these options can be removed from the execute function call or be set to “default”.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">DataQualityDashboard<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DataQualityDashboard/man/executeDqChecks.html">executeDqChecks</a></span>(<span class="dt">connectionDetails =</span> connectionDetails, </a>
<a class="sourceLine" id="cb1-2" title="2">                                      <span class="dt">cdmDatabaseSchema =</span> cdmDatabaseSchema, </a>
<a class="sourceLine" id="cb1-3" title="3">                                      <span class="dt">resultsDatabaseSchema =</span> resultsDatabaseSchema,</a>
<a class="sourceLine" id="cb1-4" title="4">                                      <span class="dt">cdmSourceName =</span> cdmSourceName, </a>
<a class="sourceLine" id="cb1-5" title="5">                                      <span class="dt">numThreads =</span> numThreads,</a>
<a class="sourceLine" id="cb1-6" title="6">                                      <span class="dt">sqlOnly =</span> sqlOnly, </a>
<a class="sourceLine" id="cb1-7" title="7">                                      <span class="dt">outputFolder =</span> outputFolder, </a>
<a class="sourceLine" id="cb1-8" title="8">                                      <span class="dt">verboseMode =</span> verboseMode,</a>
<a class="sourceLine" id="cb1-9" title="9">                                      <span class="dt">writeToTable =</span> writeToTable,</a>
<a class="sourceLine" id="cb1-10" title="10">                                      <span class="dt">checkLevels =</span> checkLevels,</a>
<a class="sourceLine" id="cb1-11" title="11">                                      <span class="dt">tablesToExclude =</span> tablesToExclude,</a>
<a class="sourceLine" id="cb1-12" title="12">                                      <span class="dt">checkNames =</span> checkNames,</a>
<a class="sourceLine" id="cb1-13" title="13">                                      <span class="dt">tableCheckThresholdLoc =</span> location of the table check file,</a>
<a class="sourceLine" id="cb1-14" title="14">                                      <span class="dt">fieldCheckThresholdLoc =</span> location of the field check file,</a>
<a class="sourceLine" id="cb1-15" title="15">                                      <span class="dt">conceptCheckThresholdLoc =</span> location of the concept check file)</a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#dqd-failure-thresholds">DQD Failure Thresholds</a><ul class="nav nav-pills nav-stacked">
<li><a href="#dqd-control-files">DQD Control Files</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clair Blacketer, Ajit Londhe, Anthony Sena, Anthony Molinaro, Frank DeFalco, Pavel Grafkin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
